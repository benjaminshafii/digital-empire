---
import PostHog from '../components/PostHog.astro';
import PhotocopyOverlay from '../components/PhotocopyOverlay.astro';
import '../styles/global.css';

interface Props {
  title: string;
  date?: Date;
  tags?: string[];
  description?: string;
}

const { title, date, tags = [], description } = Astro.props;
const siteUrl = 'https://blog.benjaminshafii.com';
const currentUrl = `${siteUrl}${Astro.url.pathname}`;
const ogDescription = description || `${title} - Benjamin Shafii's Blog`;

// Generate OG image URL with title encoded
const ogImageUrl = `${siteUrl}/og/${encodeURIComponent(title)}.png`;
---

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <PostHog />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{title} | Benjamin Shafii</title>
    <meta name="description" content={ogDescription} />
    
    <!-- Open Graph -->
    <meta property="og:type" content="article" />
    <meta property="og:title" content={title} />
    <meta property="og:description" content={ogDescription} />
    <meta property="og:url" content={currentUrl} />
    <meta property="og:image" content={ogImageUrl} />
    <meta property="og:image:width" content="1200" />
    <meta property="og:image:height" content="630" />
    <meta property="og:site_name" content="Benjamin Shafii's Blog" />
    
    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content={title} />
    <meta name="twitter:description" content={ogDescription} />
    <meta name="twitter:image" content={ogImageUrl} />
    <meta name="twitter:creator" content="@benjaminshafii" />
    
    {date && <meta property="article:published_time" content={date.toISOString()} />}
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=Libre+Baskerville:ital,wght@0,400;0,700;1,400&family=IBM+Plex+Mono:wght@400;500;700&family=VT323&display=swap" rel="stylesheet">
  </head>
  <body class="bg-outer-bg min-h-screen font-serif text-ink">
    <!-- SVG FILTERS FOR SUBTLE INK IMPERFECTIONS -->
    <svg style="display: none;" aria-hidden="true">
      <defs>
        <!-- White dust specks for dark backgrounds -->
        <filter id="whiteDots" x="0%" y="0%" width="100%" height="100%">
          <feTurbulence type="fractalNoise" baseFrequency="0.6" numOctaves="3" seed="5" result="noise"/>
          <feColorMatrix in="noise" type="matrix" values="0 0 0 0 1  0 0 0 0 1  0 0 0 0 1  0 0 0 100 -80" result="dots"/>
        </filter>

        <!-- 
          Ink Bleed - Very subtle imperfect edges (for titles only)
        -->
        <filter id="ink-bleed" x="-20%" y="-20%" width="140%" height="140%">
          <feMorphology operator="dilate" radius="0.15" in="SourceGraphic" result="thickened" />
          <feTurbulence type="fractalNoise" baseFrequency="0.9" numOctaves="2" result="noise" />
          <feDisplacementMap in="thickened" in2="noise" scale="0.5" xChannelSelector="R" yChannelSelector="G" />
        </filter>

        <!-- 
          Ink Heavy - For black header blocks (subtle)
        -->
        <filter id="ink-heavy" x="-10%" y="-10%" width="120%" height="120%">
          <feTurbulence type="fractalNoise" baseFrequency="0.6" numOctaves="3" result="noise" />
          <feDisplacementMap in="SourceGraphic" in2="noise" scale="1.0" xChannelSelector="R" yChannelSelector="G" />
        </filter>
      </defs>
    </svg>

    <!-- Main Article Container -->
    <div class="flex justify-center items-start py-8 px-4">
      <div class="relative w-full max-w-3xl bg-white border-3 border-ink-black overflow-hidden" style="filter: contrast(108%) brightness(100%); transform: rotate(-0.2deg);">
        
        <!-- Texture Layers (subtle for readability) -->
        <div class="paper-texture" style="opacity: 0.06;"></div>
        <div class="speckles-white"></div>

        <!-- Header Section (Black) -->
        <div class="bg-black text-white p-5 flex justify-between items-start border-b-3 border-ink-black relative z-10 ink-heavy">
          <div class="flex-1">
            <a href="/" class="font-mono text-[10px] uppercase tracking-widest text-white/70 hover:text-white transition-colors mix-blend-screen inline-block mb-4">
              &larr; Back to Blog
            </a>
            <h1 class="text-3xl md:text-4xl lg:text-5xl font-black tight-tracking leading-tight mix-blend-screen uppercase max-w-[95%]">
              {title}
            </h1>
          </div>
          
          <div class="flex flex-col items-end shrink-0 ml-4">
            <div class="flex gap-2 mb-2">
              <div class="w-1.5 h-1.5 bg-white rounded-full"></div>
              <div class="w-1.5 h-1.5 bg-white rounded-full"></div>
              <div class="w-1.5 h-1.5 bg-white rounded-full"></div>
              <div class="w-1.5 h-1.5 bg-white rounded-full"></div>
            </div>
            <span class="text-xs font-medium tracking-wide mix-blend-screen uppercase">Common Practice</span>
          </div>
        </div>

        <!-- Meta Bar -->
        <div class="grid grid-cols-3 relative z-10 border-b-3 border-ink-black bg-gray-50">
          <!-- Date -->
          <div class="p-3 border-r-3 border-ink-black flex items-center">
            {date && (
              <time class="font-mono text-[10px] uppercase tracking-wider text-gray-700" datetime={date.toISOString()}>
                {date.toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric' })}
              </time>
            )}
          </div>
          
          <!-- Tags -->
          <div class="p-3 border-r-3 border-ink-black flex items-center gap-2 flex-wrap">
            {tags.length > 0 && tags.slice(0, 3).map(tag => (
              <span class="font-mono text-[9px] bg-black/10 px-1.5 py-0.5 uppercase tracking-wide text-gray-700">{tag}</span>
            ))}
          </div>
          
          <!-- Personal Site Link -->
          <div class="p-3 flex items-center justify-end">
            <a href="https://www.benjaminshafii.com" class="font-mono text-[10px] uppercase tracking-widest text-gray-600 hover:text-ink transition-colors">
              Site &rarr;
            </a>
          </div>
        </div>

        <!-- Dotted Separator -->
        <div class="dotted-line relative z-10"></div>

        <!-- Article Content -->
        <article class="prose p-6 md:p-10 relative z-10">
          <slot />
        </article>
        
        <!-- Footer Section -->
        <div class="grid grid-cols-3 relative z-10 border-t-3 border-ink-black">
          <!-- Left: Social -->
          <div class="p-4 border-r-3 border-ink-black">
            <div class="flex flex-col gap-2">
              <a href="https://twitter.com/benjaminshafii" class="font-mono text-[10px] uppercase tracking-wider text-gray-600 hover:text-ink transition-colors">Twitter</a>
              <a href="https://github.com/benjaminshafii" class="font-mono text-[10px] uppercase tracking-wider text-gray-600 hover:text-ink transition-colors">GitHub</a>
            </div>
          </div>
          
          <!-- Middle: Copyright -->
          <div class="p-4 border-r-3 border-ink-black flex items-center justify-center">
            <span class="font-mono text-[10px] text-gray-500">&copy; {new Date().getFullYear()}</span>
          </div>
          
          <!-- Right: Author Label (Black Box) -->
          <div class="bg-black text-white p-4 flex items-center justify-center ink-heavy">
            <span class="font-pixel text-xl md:text-2xl uppercase mix-blend-screen">B.SHAFII</span>
          </div>
        </div>
      </div>
    </div>
  </body>
</html>
