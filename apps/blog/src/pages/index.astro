---
import { getCollection } from 'astro:content';
import PostHog from '../components/PostHog.astro';
import PhotocopyOverlay from '../components/PhotocopyOverlay.astro';
import '../styles/global.css';

const posts = (await getCollection('blog'))
  .filter(post => !post.data.draft)
  .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf());
---

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <PostHog />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Blog | Benjamin Shafii</title>
    <meta name="description" content="Thoughts on building things - Benjamin Shafii's Blog" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=Libre+Baskerville:ital,wght@0,400;0,700;1,400&family=IBM+Plex+Mono:wght@400;500;700&family=VT323&display=swap" rel="stylesheet">
  </head>
  <body class="bg-outer-bg min-h-screen font-serif text-ink flex justify-center items-start py-8 px-4">
    <!-- SVG FILTERS FOR SUBTLE INK IMPERFECTIONS -->
    <svg style="display: none;" aria-hidden="true">
      <defs>
        <!-- White dust specks for dark backgrounds -->
        <filter id="whiteDots" x="0%" y="0%" width="100%" height="100%">
          <feTurbulence type="fractalNoise" baseFrequency="0.6" numOctaves="3" seed="5" result="noise"/>
          <feColorMatrix in="noise" type="matrix" values="0 0 0 0 1  0 0 0 0 1  0 0 0 0 1  0 0 0 100 -80" result="dots"/>
        </filter>

        <!-- 
          Ink Bleed - Very subtle imperfect edges
          Barely noticeable roughness on text
        -->
        <filter id="ink-bleed" x="-20%" y="-20%" width="140%" height="140%">
          <feMorphology operator="dilate" radius="0.15" in="SourceGraphic" result="thickened" />
          <feTurbulence type="fractalNoise" baseFrequency="0.9" numOctaves="2" result="noise" />
          <feDisplacementMap in="thickened" in2="noise" scale="0.5" xChannelSelector="R" yChannelSelector="G" />
        </filter>

        <!-- 
          Ink Heavy - For black header blocks
          Subtle displacement for slightly rough edges
        -->
        <filter id="ink-heavy" x="-10%" y="-10%" width="120%" height="120%">
          <feTurbulence type="fractalNoise" baseFrequency="0.6" numOctaves="3" result="noise" />
          <feDisplacementMap in="SourceGraphic" in2="noise" scale="1.0" xChannelSelector="R" yChannelSelector="G" />
        </filter>
      </defs>
    </svg>

    <!-- Main Label Container -->
    <div class="relative w-full max-w-2xl bg-white border-3 border-ink-black overflow-hidden" style="filter: contrast(110%) brightness(100%); transform: rotate(-0.3deg);">
      
      <!-- Texture Layers -->
      <div class="paper-texture"></div>
      <div class="speckles-black"></div>
      <div class="speckles-white"></div>

      <!-- 1. HEADER SECTION (Black) -->
      <div class="bg-black text-white p-5 flex justify-between items-end border-b-3 border-ink-black relative z-10 ink-heavy">
        <h1 class="text-4xl md:text-5xl lg:text-6xl font-black tight-tracking leading-none mix-blend-screen uppercase">
          Benjamin<br>Shafii
        </h1>
        
        <div class="flex flex-col items-end mb-1">
          <div class="flex gap-3 mb-2">
            <div class="w-1.5 h-1.5 bg-white rounded-full"></div>
            <div class="w-1.5 h-1.5 bg-white rounded-full"></div>
            <div class="w-1.5 h-1.5 bg-white rounded-full"></div>
            <div class="w-1.5 h-1.5 bg-white rounded-full"></div>
          </div>
          <span class="text-sm font-medium tracking-wide mix-blend-screen uppercase">Common Practice</span>
        </div>
      </div>

      <!-- 2. MIDDLE SECTION GRID -->
      <div class="grid grid-cols-2 relative z-10">
        
        <!-- Left Box -->
        <div class="p-5 border-r-3 border-b-3 border-ink-black flex flex-col justify-center min-h-[140px]">
          <p class="text-lg font-bold leading-tight max-w-xs ink-bleed" style="transform: scaleY(1.05);">
            THOUGHTS ON BUILDING PRODUCTS, CRYPTO, AND THE FUTURE OF SOFTWARE.
          </p>
        </div>

        <!-- Right Box -->
        <div class="flex border-b-3 border-ink-black min-h-[140px]">
          <div class="flex-grow flex items-center justify-center relative overflow-hidden p-4">
            <a href="https://www.benjaminshafii.com" class="text-2xl md:text-3xl font-bold tight-tracking z-10 ink-bleed hover:underline">
              Personal Site &rarr;
            </a>
          </div>
          <!-- Vertical Number Strip -->
          <div class="w-12 border-l-4 border-black flex items-center justify-center bg-gray-100">
            <span class="transform rotate-90 whitespace-nowrap font-mono font-bold tracking-widest text-xs text-gray-800 ink-bleed">
              {posts.length.toString().padStart(3, '0')}-POST
            </span>
          </div>
        </div>
      </div>

      <!-- 3. POSTS SECTION -->
      <div class="relative z-10">
        <!-- Section Header -->
        <div class="w-full py-2 border-b-3 border-black text-center bg-gray-50">
          <span class="text-xs font-bold tracking-wide ink-bleed uppercase">Latest Articles - Field Notes</span>
        </div>
        
        <!-- Dotted Separator -->
        <div class="dotted-line"></div>

        <!-- Posts List -->
        <ul class="divide-y divide-gray-300">
          {posts.map((post, index) => (
            <li class="relative">
              <a href={`/blog/${post.slug}`} class="block p-4 md:p-5 group hover:bg-white/50 transition-colors">
                <div class="flex items-start gap-3">
                  <span class="font-mono text-xs text-gray-500 pt-0.5 font-bold ink-bleed">
                    {String(index + 1).padStart(2, '0')}
                  </span>
                  <div class="flex-1 min-w-0">
                    <h3 class="font-sans font-black text-lg md:text-xl tight-tracking leading-tight group-hover:underline decoration-2 underline-offset-2 ink-bleed">
                      {post.data.title}
                    </h3>
                    <div class="flex items-center gap-3 mt-2 flex-wrap">
                      <time class="font-mono text-[10px] uppercase tracking-wider text-gray-600">
                        {post.data.date.toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric' })}
                      </time>
                      {post.data.tags.length > 0 && (
                        <div class="flex gap-1.5 flex-wrap">
                          {post.data.tags.slice(0, 2).map(tag => (
                            <span class="font-mono text-[9px] bg-black/10 px-1.5 py-0.5 uppercase tracking-wide text-gray-700">{tag}</span>
                          ))}
                        </div>
                      )}
                    </div>
                  </div>
                  <span class="font-mono text-[10px] text-gray-400 opacity-0 group-hover:opacity-100 transition-opacity shrink-0">
                    READ
                  </span>
                </div>
              </a>
            </li>
          ))}
        </ul>
      </div>

      <!-- 4. FOOTER SECTION -->
      <div class="grid grid-cols-3 relative z-10 border-t-3 border-ink-black">
        <!-- Left: Social -->
        <div class="p-4 border-r-3 border-ink-black">
          <div class="flex flex-col gap-2">
            <a href="https://twitter.com/benjaminshafii" class="font-mono text-[10px] uppercase tracking-wider text-gray-600 hover:text-ink transition-colors">Twitter</a>
            <a href="https://github.com/benjaminshafii" class="font-mono text-[10px] uppercase tracking-wider text-gray-600 hover:text-ink transition-colors">GitHub</a>
          </div>
        </div>
        
        <!-- Middle: Copyright -->
        <div class="p-4 border-r-3 border-ink-black flex items-center justify-center">
          <span class="font-mono text-[10px] text-gray-500">&copy; {new Date().getFullYear()}</span>
        </div>
        
        <!-- Right: BLOG Label (Black Box) -->
        <div class="bg-black text-white p-4 flex items-center justify-center ink-heavy">
          <span class="font-pixel text-3xl uppercase mix-blend-screen">BLOG</span>
        </div>
      </div>
    </div>
  </body>
</html>
