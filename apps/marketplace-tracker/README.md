# mkt - Marketplace Tracker

Automate Facebook Marketplace searches with AI. Get reports with actionable links.

## Install

```bash
# From source (requires bun)
cd apps/marketplace-tracker
bun install
bun run build
cp dist/mkt ~/.local/bin/
```

Or run directly:

```bash
bun run dev --help    # CLI
bun run serve         # Web UI at http://localhost:3456
```

## Quick Start

```bash
# Create a search (name auto-generated by AI)
mkt add -p "Standing desk under 300, prefer electric"

# Or with a custom name
mkt add "speakers" --prompt "Good speakers under 200"

# Run it (opens in tmux, you can watch live)
mkt run speakers

# Watch the job
mkt watch

# Check status
mkt jobs

# View results
mkt show speakers
```

## Web UI

```bash
bun run serve
# Open http://localhost:3456
```

Features:
- Dashboard with all searches and job status
- Add new searches (AI auto-generates names)
- Run searches with one click
- View reports with rendered markdown and clickable links
- Cancel running jobs, clear queue

## CLI Commands

```bash
# Searches
mkt add [name] -p "prompt"  # Create search (name optional, AI generates)
mkt list                    # List all searches
mkt show <slug>             # View latest report
mkt delete <slug>           # Delete a search

# Jobs
mkt run <slug>              # Run a search
mkt jobs                    # List recent jobs
mkt watch [job-id]          # Attach to running tmux session
mkt sync                    # Fix orphaned job statuses

# Cancel/Clear
mkt cancel <job-id>         # Cancel specific job
mkt cancel --all            # Cancel running job
mkt cancel --queue          # Clear queued jobs
mkt cancel --jobs           # Delete ALL job history

# Scheduling
mkt schedule set <slug> <cron>  # Set cron schedule
mkt schedule list               # List scheduled searches
mkt schedule install            # Generate cron script
```

## How It Works

1. **Searches** are saved configurations (what to search, where, optional schedule)
2. **Jobs** run in **tmux sessions** via opencode's `fb-marketplace` agent
3. Jobs run **sequentially** to avoid Chrome/browser conflicts
4. You can watch live (`mkt watch`) or let it run in background
5. **Reports** are extracted as markdown with clickable Facebook links
6. **Web UI** provides a nice interface for everything

## Storage

Data is stored in `./data/` (gitignored):

```
apps/marketplace-tracker/data/
├── queue.json                    # Job queue state
└── searches/
    └── speakers/
        ├── config.json           # Search config
        └── jobs/
            └── abc123/
                ├── meta.json     # Job metadata
                ├── run.sh        # Execution script
                ├── prompt.txt    # Prompt sent to AI
                ├── output.log    # Raw output
                └── report.md     # Extracted report
```

## Requirements

- [opencode](https://opencode.ai) with `fb-marketplace` agent configured
- tmux - for job sessions (`brew install tmux`)
- bun - for running/building

## Architecture

```
┌─────────────────────────────────────────────────┐
│  Web UI (Hono + HTMX)    │  CLI (Bun)           │
├─────────────────────────────────────────────────┤
│  Core: SearchStore, JobStore, JobRunner         │
├─────────────────────────────────────────────────┤
│  tmux sessions (background job execution)       │
├─────────────────────────────────────────────────┤
│  opencode run --agent fb-marketplace            │
└─────────────────────────────────────────────────┘
```

The tool is a thin wrapper around opencode. It:
- Stores search configurations
- Manages job queue (sequential to avoid Chrome conflicts)
- Runs opencode in tmux for live visibility
- Extracts reports with links from output
- Provides web UI for easy access

## Report Format

Reports include:
- **Top Picks** with direct Facebook Marketplace links
- **Other Options** in table format
- **What to Avoid** - overpriced or sketchy listings
- Seller info, condition, price history when available

Example:
```markdown
## Top Picks

### 1. [Standing Desk - $150](https://www.facebook.com/marketplace/item/123...)
- **Seller:** John (15 ratings)
- **Condition:** Like New
- **Why it's great:** Electric, height adjustable, was $300 new
```

## Scheduling

```bash
# Set a daily 9am schedule
mkt schedule set speakers "0 9 * * *"

# Generate the runner script
mkt schedule install

# View the script
cat ~/.config/marketplace-tracker/run-scheduled.sh

# Add to crontab manually or use launchd on macOS
```
